
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
<!-- If no var is set for $page_title on the top of each page than default title will be HDF Group -->

<title>
The HDF Group - Information, Support, and Software</title>
	<meta name="keywords" content="hdf, hdfeos, blog, hdf blog, hdf5 blog, hdf5, hdf4, hdf tools, hdf libraries, hdf viewer, hdf format, hdf file, hdf java, nafxcw.lib, phdf5, open source, hierarchical data format, ncsa, database, python hdf, mike folk, hdfview, hdf5 parallel" />
	<meta name="description" content="The HDF Group is a not-for-profit corporation with the mission of sustaining the HDF technologies and supporting HDF user communities worldwide with production-quality software and services." />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="expires" content="Wed, 26 Feb 2010 08:21:57 GMT" />
	<meta name="verify-v1" content="/m03HNmaDgGAcDe0PFtEVnXGtCkoeOocjr/Jwey2gdI=" />
	<link href="../../css/layout.css" rel="stylesheet" type="text/css" media="screen, projection" />
	<link href="../../css/print.css" rel="stylesheet" type="text/css" media="print" />
	<link rel="stylesheet" type="text/css" href="../../css/js_style.css" />
	<link rel="shortcut icon" href="../../images/favicon.ico" type="image/x-icon" />
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/prototype/1.7.2.0/prototype.js"></script>
	<!--<script type="text/javascript" src="/scriptaculous/lib/prototype.js"></script>-->
	<script type="text/javascript" src="../../scriptaculous/src/effects.js"></script>
	<script type="text/javascript" src="../../scriptaculous/validation.js"></script>
	<script type="text/javascript" src="../../scriptaculous/animatedcollapse.js"></script>
	<script type="text/javascript" src="../../scriptaculous/rollover.js"></script>	
	<script type="text/javascript" src="../../scriptaculous/functions.js"></script>
	<script type="text/javascript" src="../../scriptaculous/sorttable.js"></script>
	<!--<script type="text/javascript" src="/jquery-1.2.2.pack.js"></script>-->
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="../../scriptaculous/jssor.slider.min.js"></script>

 	<link rel="stylesheet" type="text/css" href="../../featuredcontentglider.css" />
    <script type="text/javascript" src="../../featuredcontentglider.js"></script>

	</head>
	<body>
	<div id="mast_head">
		<a href="https://www.hdfgroup.org/"><img src="../../images/hdf_logo.jpg" height="70" style="display:block; padding-left:10px;" align="left" alt="hdf images" /></a>
		<img src="../../images/logo_5.jpg" height="70" style="display:block;" align="right" alt="hdf images" />
	</div> 
				
	<div id="nav_wrapper">
		<div>
		<div id="section-">
			<ul id="nav">
				<li id="t-index"><a href="https://www.hdfgroup.org/">Home</a> </li>
				<li id="t-products"><a href="../../products/index.html">Products</a></li>
				<li id="t-services"><a href="../../services/index.html">Services</a></li>
				<li id="t-about"><a href="../../about/index.html">About Us</a></li>
				<li id="t-news"><a href="../../news/index.html">News</a> </li>
				<li id="t-blog"><a href="https://www.hdfgroup.org/blog">Blog</a></li>
				<li id="t-contact"><a href="../../about/contact.html">Contact Us</a></li> 
			</ul>
			<script type="text/javascript">
			
  (function() {
    var cx = '007250492606109219119:sb2eg2bgoyy';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>	
					<script type="text/javascript">
					    jQuery(document).ready(function ($) {
					        // var options = {
					        //     $ArrowNavigatorOptions: {
					        //         $Class: $JssorArrowNavigator$,
					        //         $ChanceToShow: 2
					        //     }
					        // };					    	


							var options = { 
											$AutoPlay: true, $SlideshowOptions: { $Class: $JssorSlideshowRunner$, $Transitions: [{ $Duration:5000, $Fade: true, $Opacity:2 }] } , 
											$ArrowNavigatorOptions: { 
												$Class: $JssorArrowNavigator$, 
												$ChanceToShow: 2
											}
										  };


					        var jssor_slider1 = new $JssorSlider$('slider1_container', options);
					    });
					</script>
									                  
			
		</div>
		</div>             
	</div>
				
<!--START: MAIN -->
<div id="wrapper" style="margin-top:-15px;"> 

<!--START: SIDE_BAR -->
<div id="side_bar">

<form method="get" action="layout.html" class="form" >
	<select onchange="window.open(this.options[this.selectedIndex].value,'_top')" name="" style="border:2px solid #c1c1c1;">
		<option value="" class="ql1">- - Quick Links - -</option>
		<option value="/HDF5/" class="ql">HDF5</option>
		<option value="/products/hdf4/" class="ql">HDF4</option>
		<option value="/tools/" class="ql">Tools</option>
		<option value="/projects/" class="ql">Projects</option>
		<option value="/downloads/" class="ql">Downloads</option>
		<option value="/documentation/" class="ql">Documentation</option>
	        <option value="/pubs/" class="ql">Publications</option>
		<option value="/about/" class="ql">Contact Us</option>
	</select>
</form>
<ul style="border:1px solid #c1c1c1; margin-top:25px;"> 

	<li style="background:url(../../images/menubg.png); padding:0px; padding-left:7px; color:#27343C; font-weight:500; text-align:left;">
	LINKS</li><li><a href="https://www.hdfgroup.org/">Main Website</a></li><li><a  href="../whatishdf5.html">What is HDF5?</a></li><li><a  href="../../about/HDF5Brochure_2012.pdf">Online Brochure</a></li><li><a  href="../../downloads/index.html">Downloads</a></li><li><a  href="../doc/index.html">Documentation</a></li><li><a  href="../../products/hdf5_tools/index.html">Software using HDF5</a></li><li><a  href="../users5.html">HDF5 Users</a></li><li><a  href="../hdf5-files.html">Sample HDF5 Files</a></li><li><a  href="../acknowledge5.html">Acknowledgments</a></li><li><a  href="../../products/licenses.html">Licenses</a></li></ul> 

</div>

<!--END: SIDE_BAR -->

<!--START: CONTENT -->
<div id="content">
<p><font color="red"><center><strong>This web site is no longer maintained (but will remain online).<br /> Please see The HDF Group's new <a href="https://portal.hdfgroup.org">Support Portal</a> for the latest information.</strong></center></font></p>
	<div class=bc><p style="color:orange; ";><a href="../../index.html" title="HOME">HOME</a> &gt; <a href="../../products/hdf5/index.html" title="HDF5">HDF5</a> &gt; <a href="../Tutor.html" title="TUTOR">TUTOR</a></p></div>
<fieldset><h1>HDF5 Tutorial: &nbsp; Learning The Basics<br />
 Dataset Storage Layout</h1></fieldset>

<h2>Contents:</h2>
<ul class="ul">
    <li class="li3"><a href="layout.html#def">Description of a Dataset</a> 
    <li class="li3"><a href="layout.html#lo-define">Dataset Storage Layout: Contiguous, Chunked, Compact</a> </li>
    <li class="li3"><a href="layout.html#modify">Programming Model to Modify the Storage Layout</a></li>
    <li class="li3"><a href="layout.html#chglo">Changing the Layout after Dataset Creation</a></li>
    <li class="li3"><a href="layout.html#info">Sources of Information</a></li>
</ul>

<hr />

<a name="def"> </a>

<h2>Description of a Dataset</h2>

<p>
The <a href="crtdat.html">Create Dataset</a> tutorial topic defines a
dataset as a &quot;multidimensional array of data elements together with 
supporting metadata.&quot;  
The array of elements simply consists of the raw data
values that a user wishes to store in HDF5, and the supporting metadata
describes that data. The metadata is stored in the dataset (object) header of 
a dataset.
</p>
<p>
Previous tutorial topics introduced datatypes and dataspaces, as well
as attributes. These are part of the supporting metadata for a dataset.
The metadata also includes the storage information for the dataset:
</p>
<p>
<img src ="../../images/tutr-lodset.png" width=500>
</p>

<a name="lo-define"></a>
<h2>Dataset Storage Layout</h2>

<p>
The storage information, or storage layout, defines how the raw data values in the dataset are 
physically stored on disk.  There are three ways that a dataset can be stored:
 contiguous, chunked, and compact. (See the H5Pset_layout/H5Pget_layout APIs for details.) 
</p>
<h3>Contiguous</h3>
<p>
If the storage layout is contiguous, then the raw data values will be stored
physically adjacent to each other in the HDF5 file (in one contiguous block).
This is the default layout for a dataset. In other words, if you do not explicitly change 
the storage layout for the dataset, then it will be stored contiguously.
</p>
<p>
<img src ="../../images/tutr-locons.png" width=500>
</p>
<!--
<p>
Some users may never have a need to change the storage layout for their datasets. Their datasets
may be finite in size and not excessively large or plentiful, and they may not encounter
performance issues using HDF5. 
</p>
-->

<h3>Chunked</h3>

<p>
With a chunked storage layout the data is stored in equal-sized blocks or chunks of a pre-defined size.
The HDF5 library always writes and reads the entire chunk:
<br />
<img src ="../../images/tutr-lochk.png" width=500>
</p>

<p>
Each chunk is stored as a separate contiguous block in the HDF5 file. There is a chunk index which keeps
track of the chunks associated with a dataset:
<br />
<img src ="../../images/tutr-lochks.png" width=500>
</p>

<!--
<p>
The chunk dimensions do not need to be a factor of the dataset's dimension. There can be unused space
in the last chunk(s) for a dataset. (Compression can be considered if there is too much unused space.)
</p>
-->

<p><strong>Why Chunking ? </strong><p>
<p>
Chunking is required for enabling compression and other filters, as well as for creating extendible
or unlimited dimension datasets. 
</p>

<p>
It is also commonly used when subsetting very large datasets. 
Using the chunking layout can greatly improve performance when subsetting large datasets, because only
the chunks required will need to be accessed.  However, it is easy to use chunking without considering 
the consequences of the chunk size, which can lead to strikingly poor performance. 
</p>

<p>
Note that a chunk always has the same rank as the dataset and
the chunk's dimensions do not need to be factors of the dataset dimensions.
</p>

<p>
Writing or reading a chunked dataset is <strong>transparent</strong> to the
application. You would use the same set of operations that you would use for
a contiguous dataset. For example:
<pre>
   H5Dopen (...);
   H5Sselect_hyperslab (...);
   H5Dread (...);
</pre>
</p>

<p><strong>Problems Using Chunking </strong></p>

Issues that can cause performance problems with chunking include:
<ul class="ul">
<li class="li3">
<p>Chunks are too small.</p>
<p>
If a very small chunk size is specified for a dataset it can cause the dataset to be excessively large and
it can result in degraded performance when accessing the dataset. The smaller the chunk size the more chunks that HDF5
has to keep track of, and the more time it will take to search for a chunk.
</p>
<p>

</li>
<li class="li3">
<p>Chunks are too large.</p>
<p>
An entire chunk has to be read and uncompressed before performing an operation. There can be
a performance penalty for reading a small subset, if the chunk size is subtantially larger than
the subset. Also, a dataset may be larger than expected if there are chunks that only contain
a small amount of data.
</p>
<p>
</li>

<li class="li3">
A chunk does not fit in the <em>Chunk Cache</em>.
<p>
Every chunked dataset has a chunk cache associated with it that has a default size of 1 MB. The purpose of the
chunk cache is to improve performance by keeping chunks that are accessed frequently in memory so that they
do not have to be accessed from disk. If a chunk is too large to fit in the chunk cache, it
can significantly degrade performance. However, the size of the chunk cache can be increased by calling
<a href="../doc/RM/RM_H5P.html#Property-SetChunkCache">H5Pset_chunk_cache</a>.
<p>
</li>
</ul>

<p>
It is a good idea to:
<ol class="ol"> 
 <li>
 Avoid very small chunk sizes, and be aware of the 1 MB chunk cache size default.
 </li>
 <li>
 Test the data with different chunk sizes to determine the optimal chunk size to use.
 </li>
 <li>
 Consider the chunk size in terms of the most common access patterns that will be used 
 once the dataset has been created.
  </li>
</ol>
</p>
  


<h3>Compact</h3>
<p>
A compact dataset is one in which the raw data is stored in the object
header of the dataset. This layout is for very small datasets 
that can easily fit in the object header.
 </p>
<p>
  
<p>
The compact layout can improve storage and access performance for files that have many very tiny datasets. 
With one I/O access both the header and data values can be read.
The compact layout reduces the size of a file, as the data is stored with the header
which will always be allocated for a dataset. However, the object header is 64 KB in size, so this layout can only be used
for very small datasets.
</p>


<a name="modify"></a>
<h2>Programming Model to Modify the Storage Layout</h2>
<p>
To modify the storage layout, the following steps must be done:
</p>
<p>
<ul class="ul">
 <li class="li3">Create a Dataset Creation Property list.
            (See <a href="../doc/RM/RM_H5P.html#Property-Create">H5Pcreate / h5pcreate_f</a>)</li>
 <li class="li3">Modify the property list.
   <p>
   To use chunked storage layout, call: <a href="../doc/RM/RM_H5P.html#Property-SetChunk">H5Pset_chunk / h5pset_chunk_f</a>
   <br />
   To use the  compact storage layout, call: <a href="../doc/RM/RM_H5P.html#Property-SetLayout">H5Pset_layout / h5pset_layout_f</a> 
</p>

  </li>
 <li class="li3">Create a dataset with the modified property list.
             (See <a href="../doc/RM/RM_H5D.html#Dataset-Create">H5Dcreate / h5dcreate_f</a>)</li>

 <li class="li3">Close the property list. (See <a href="../doc/RM/RM_H5P.html#Property-Close">H5Pclose / h5pclose_f</a> )</li>
</ul>
</p>

<p>
For example code, see the <a href="../examples/index.html">HDF5 Examples</a> page. Specifically look
at the Examples by API. There are examples for different languages.
</p>
<p>
 The C example to create a chunked dataset is: <a href="https://support.hdfgroup.org/ftp/HDF5/examples/examples-by-api/hdf5-examples/1_8/C/H5D/h5ex_d_chunk.c">h5ex_d_chunk.c</a>
<br />
The C example to create a compact dataset is: <a href="https://support.hdfgroup.org/ftp/HDF5/examples/examples-by-api/hdf5-examples/1_8/C/H5D/h5ex_d_compact.c">h5ex_d_compact.c</a>
</p>



<a name="chglo"></a>
<h2>Changing the Layout after Dataset Creation</h2>
<p>
The dataset layout is a Dataset Creation Property List. This means that once the dataset has been created
the dataset layout cannot be changed. The h5repack utility can be used to write a file to a new with a new layout. 
</p>


<a name="info"></a>
<h2> Sources of Information</h2>
<p>
<a href="../doc/Advanced/Chunking/index.html">Chunking in HDF5</a> (See 
the documentation on <a href="../doc/Advanced.html">Advanced Topics in HDF5</a>) <br />
See &quot;Properties and Property Lists&quot; in the HDF5 User's Guide.
</p>



<hr />


<i>
- - Last modified: 31 January 2017</i>
	   </div>
	   <!--END: CONTENT -->
<!--END: WRAPPER -->
<script src="../../scriptaculous/gatag.js" type="text/javascript"></script>

<!-- <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script> -->
				
<!--
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>

<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-3782034-1");
pageTracker._trackPageview();
} catch(err) {}</script>
-->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3782034-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>

